name: "Pull Request Size Labeler"

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-size-labeler:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/github-script@v7
      with:
        script: |
          const { data: files } = await github.rest.pulls.listFiles({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: context.issue.number,
          });
          
          const totalChanges = files.reduce((acc, file) => acc + file.changes, 0);
          
          let sizeLabel = '';
          if (totalChanges <= 10) {
            sizeLabel = 'size/XS';
          } else if (totalChanges <= 50) {
            sizeLabel = 'size/S';
          } else if (totalChanges <= 250) {
            sizeLabel = 'size/M';
          } else if (totalChanges <= 1000) {
            sizeLabel = 'size/L';
          } else {
            sizeLabel = 'size/XL';
          }
          
          // Remove existing size labels
          const { data: labels } = await github.rest.issues.listLabelsOnIssue({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: context.issue.number,
          });
          
          const existingSizeLabels = labels.filter(label => label.name.startsWith('size/'));
          for (const label of existingSizeLabels) {
            await github.rest.issues.removeLabel({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              name: label.name,
            });
          }
          
          // Add new size label
          await github.rest.issues.addLabels({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: context.issue.number,
            labels: [sizeLabel],
          });
